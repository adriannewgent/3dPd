#N canvas 536 105 457 326 10;
#X obj 94 32 loadbang;
#X obj 94 77 pack s \$1;
#X obj 94 54 canvasdollarzero 1;
#X obj 94 143 oreceive;
#X msg 94 121 symbol \$1-output\$2;
#X obj 29 164 inlet~;
#X obj 94 165 t f f;
#X msg 94 187 set output\$1;
#X obj 29 254 tabsend~;
#X obj 94 99 t l l;
#N canvas 833 374 842 591 handle_metadata 0;
#X obj 53 411 oreceive;
#X obj 53 458 t b f;
#X msg 85 530 symbol get_metadata\$1;
#X obj 53 547 s;
#X obj 53 482 list;
#X msg 134 134 symbol \$1-metalink\$2;
#X obj 134 156 oreceive;
#X text 138 111 this will receive metadata from a linked input;
#X msg 53 389 symbol give_metadata\$1;
#X obj 53 67 inlet;
#X obj 134 67 inlet;
#X obj 53 89 t f f;
#X obj 576 128 oreceive;
#X obj 608 195 list;
#X obj 608 172 t b f;
#X obj 608 237 s;
#X msg 640 220 symbol clear_metadata\$1;
#X msg 576 106 symbol erase_metadata\$1;
#X obj 53 435 t f f;
#X obj 202 442 inlet metadata;
#N canvas 284 178 612 381 linked_metadata 0;
#X obj 319 232 inlet;
#X obj 39 78 inlet clear;
#X obj 319 256 list-abs/list-extend;
#X obj 39 104 list-abs/list-find;
#X obj 176 231 list-abs/list-idx;
#X obj 39 148 + 1;
#X obj 176 253 + 2;
#X text 175 199 erase both the output nr and the number of metadata
along with the actual metadata;
#X obj 39 170 t b f;
#X obj 39 192 list;
#X obj 365 303 outlet;
#X text 39 5 this subpatch only takes care of deleting a disconnecting
linked input and setting the rest of the list (if there's anything
left) to the right inlet of [list prepend] in the main abstraction
window;
#X obj 39 126 t f f;
#X obj 39 298 list-abs/list-delete;
#X obj 319 279 t a a a;
#X obj 39 321 t a a;
#X obj 39 214 t a a;
#X connect 0 0 2 0;
#X connect 1 0 3 0;
#X connect 2 0 14 0;
#X connect 3 0 12 0;
#X connect 4 0 6 0;
#X connect 5 0 8 0;
#X connect 6 0 13 2;
#X connect 8 0 9 0;
#X connect 8 1 4 1;
#X connect 9 0 16 0;
#X connect 12 0 5 0;
#X connect 12 1 13 1;
#X connect 13 0 15 0;
#X connect 14 0 9 1;
#X connect 14 1 3 1;
#X connect 14 2 10 0;
#X connect 15 0 14 0;
#X connect 15 1 2 1;
#X connect 16 0 13 0;
#X connect 16 1 4 0;
#X restore 270 279 pd linked_metadata;
#N canvas 1141 295 566 517 clear_linked_metadata 0;
#X obj 203 336 inlet;
#X obj 39 78 inlet clear;
#X obj 71 424 outlet;
#X obj 39 104 list-abs/list-find;
#X obj 71 237 list-abs/list-idx;
#X obj 71 401 list store;
#X obj 39 148 + 1;
#X obj 71 305 pack;
#X msg 71 379 get \$2 \$1;
#X obj 71 259 + 2;
#X text 119 260 erase both the output nr and the number of metadata
along with the actual metadata;
#X obj 39 170 t b f;
#X obj 39 192 list;
#N canvas 1 82 337 352 create_clear_linked_list 0;
#X obj 86 120 list;
#X obj 86 96 until;
#X obj 86 142 list split 2;
#X obj 86 188 list split 1;
#X obj 86 210 list append clear;
#X obj 86 17 inlet;
#X obj 61 301 outlet;
#X obj 86 39 t b l;
#X obj 118 62 list split 2;
#X obj 86 232 list-abs/list-extend;
#X obj 223 208 inlet;
#X obj 61 278 list prepend;
#X obj 61 255 list;
#X obj 167 165 t b b;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X connect 2 0 3 0;
#X connect 2 1 0 1;
#X connect 2 2 13 0;
#X connect 3 0 4 0;
#X connect 4 0 9 0;
#X connect 5 0 7 0;
#X connect 7 0 1 0;
#X connect 7 1 8 0;
#X connect 8 0 11 1;
#X connect 8 1 0 1;
#X connect 9 0 12 1;
#X connect 10 0 9 1;
#X connect 11 0 6 0;
#X connect 12 0 11 0;
#X connect 13 0 12 0;
#X connect 13 1 1 1;
#X restore 203 359 pd create_clear_linked_list;
#X text 39 11 the linked data that are cleared need to both be routed
to the connecting input and keep track of the deleted output to the
linked input of this instance;
#X obj 39 454 list-abs/list-delete 0 1;
#X obj 39 126 t f f f;
#X obj 71 281 t f f;
#X obj 263 407 outlet;
#X obj 203 384 t a a a a;
#X obj 39 214 t a a;
#X obj 39 476 t a a;
#X connect 0 0 13 0;
#X connect 1 0 3 0;
#X connect 3 0 16 0;
#X connect 4 0 9 0;
#X connect 5 0 2 0;
#X connect 6 0 11 0;
#X connect 7 0 8 0;
#X connect 8 0 5 0;
#X connect 9 0 17 0;
#X connect 11 0 12 0;
#X connect 11 1 4 1;
#X connect 12 0 20 0;
#X connect 13 0 19 0;
#X connect 15 0 21 0;
#X connect 16 0 6 0;
#X connect 16 1 7 1;
#X connect 16 2 15 1;
#X connect 17 0 7 0;
#X connect 17 1 15 2;
#X connect 19 0 5 1;
#X connect 19 1 12 1;
#X connect 19 2 3 1;
#X connect 19 3 18 0;
#X connect 20 0 15 0;
#X connect 20 1 4 0;
#X connect 21 0 19 0;
#X connect 21 1 13 1;
#X restore 260 387 pd clear_linked_metadata;
#X obj 134 240 spigot;
#X obj 134 262 t f f;
#X msg 243 223 1;
#X text 183 245 go through the list clearing process only in case this
output is linked to an input;
#N canvas 1293 529 626 383 connected_inputs 0;
#X obj 234 134 list-abs/list-extend;
#X obj 51 173 list;
#X text 43 12 keep track of the connecting inputs in case of linked
metadata \, so we can clear it when the linked input in this module
gets disconnected;
#X obj 51 196 list-abs/list-drip;
#X obj 51 348 s;
#X obj 51 218 t b f;
#X obj 51 240 list;
#X obj 234 87 inlet connect;
#X obj 396 87 inlet disconnect;
#X obj 396 210 list-abs/list-find;
#X obj 396 280 list-abs/list-delete 0 1;
#X obj 396 256 list;
#X obj 396 232 t b f;
#X obj 51 87 inlet clear;
#X obj 148 87 inlet get;
#X obj 113 220 sel 0 1;
#X msg 113 272 symbol clear;
#X msg 136 243 symbol get;
#X obj 83 305 pack f s;
#X msg 113 126 0;
#X msg 180 131 1;
#X msg 83 331 symbol \$2_metadata\$1;
#X obj 396 302 t a a;
#X obj 234 156 t a a a;
#X obj 51 109 t a b;
#X obj 148 109 t a b;
#X obj 51 149 t b a;
#X connect 0 0 23 0;
#X connect 1 0 3 0;
#X connect 3 0 5 0;
#X connect 5 0 6 0;
#X connect 5 1 18 0;
#X connect 6 0 4 0;
#X connect 7 0 0 0;
#X connect 8 0 9 0;
#X connect 9 0 12 0;
#X connect 10 0 22 0;
#X connect 11 0 10 0;
#X connect 12 0 11 0;
#X connect 12 1 10 1;
#X connect 13 0 24 0;
#X connect 14 0 25 0;
#X connect 15 0 16 0;
#X connect 15 1 17 0;
#X connect 16 0 18 1;
#X connect 17 0 18 1;
#X connect 18 0 21 0;
#X connect 19 0 15 0;
#X connect 20 0 15 0;
#X connect 21 0 4 1;
#X connect 22 0 23 0;
#X connect 22 1 0 1;
#X connect 23 0 1 1;
#X connect 23 1 11 1;
#X connect 23 2 9 1;
#X connect 24 0 26 0;
#X connect 24 1 19 0;
#X connect 25 0 26 0;
#X connect 25 1 20 0;
#X connect 26 0 1 0;
#X connect 26 1 6 1;
#X restore 260 409 pd connected_inputs;
#X obj 53 504 list prepend;
#X text 319 301 this might create a bit of overhead which might cause
the linked metadata to be sent more than once \, but this way we can
send the linked metadata both when the linked output is connected after
it receives the linked metadata and when it is connected before that
;
#X obj 576 150 t f f;
#X obj 134 178 route disconnect;
#N canvas 306 154 729 429 own_metadata 0;
#X obj 85 152 list-abs/list-extend;
#X obj 39 94 list-abs/list-drip;
#X obj 85 312 t l l;
#N canvas 308 388 393 327 create_clear_list 0;
#X obj 146 129 list;
#X obj 146 66 until;
#X obj 146 151 list split 2;
#X obj 146 173 list split 1;
#X obj 146 195 list append clear;
#X obj 146 217 list-abs/list-extend;
#X obj 24 15 inlet;
#X obj 146 15 inlet;
#X obj 146 260 outlet;
#X obj 24 37 list split 2;
#X obj 146 239 list prepend;
#X obj 146 37 t b b;
#X connect 0 0 2 0;
#X connect 1 0 0 0;
#X connect 2 0 3 0;
#X connect 2 1 0 1;
#X connect 2 2 1 1;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X connect 5 0 10 0;
#X connect 6 0 9 0;
#X connect 7 0 11 0;
#X connect 9 0 10 1;
#X connect 9 1 0 1;
#X connect 10 0 8 0;
#X connect 11 0 1 0;
#X connect 11 1 5 1;
#X restore 117 334 pd create_clear_list;
#X obj 85 174 t l l;
#X obj 166 211 list length;
#X obj 85 289 list prepend;
#X text 179 287 include output nr and nr of metadata in the list so
we can easily delete parts of lists from linked outputs;
#X obj 39 128 sel : |;
#X obj 222 111 t b b;
#X obj 166 233 list prepend \$1;
#X text 280 233 <- this argument is actually replaced when this abstraction
is placed in the main patch \, but it's here to prevent Pd from crashing
when we open the abstraction by itself;
#X obj 64 42 inlet;
#X obj 85 381 outlet;
#X obj 117 356 outlet;
#X text 104 130 exclude colon and slash from resulting list;
#X obj 236 165 inlet;
#X obj 39 67 list;
#X obj 236 187 t b f;
#X text 284 188 wait first for the outlet number to come in and then
store the metadata list;
#X connect 0 0 4 0;
#X connect 1 0 8 0;
#X connect 1 1 9 0;
#X connect 2 0 13 0;
#X connect 2 1 3 0;
#X connect 3 0 14 0;
#X connect 4 0 6 0;
#X connect 4 1 5 0;
#X connect 5 0 10 0;
#X connect 6 0 2 0;
#X connect 8 2 0 0;
#X connect 9 0 0 1;
#X connect 9 1 3 1;
#X connect 10 0 6 1;
#X connect 12 0 17 1;
#X connect 16 0 18 0;
#X connect 17 0 1 0;
#X connect 18 0 17 0;
#X connect 18 1 10 1;
#X restore 202 465 pd own_metadata;
#X obj 53 324 t f f;
#X obj 270 301 t a a;
#X text 62 18 use [t a] instead of [t l] because when a list is emptied
it outputs a bang;
#X obj 393 218 t a a;
#X obj 243 201 t b a;
#X obj 467 482 t b a;
#X obj 425 513 list append;
#X connect 0 0 18 0;
#X connect 1 0 4 0;
#X connect 1 1 2 0;
#X connect 2 0 3 1;
#X connect 4 0 27 0;
#X connect 5 0 6 0;
#X connect 6 0 30 0;
#X connect 8 0 0 0;
#X connect 9 0 11 0;
#X connect 10 0 5 0;
#X connect 11 0 32 0;
#X connect 11 1 17 0;
#X connect 12 0 29 0;
#X connect 13 0 15 0;
#X connect 14 0 13 0;
#X connect 14 1 16 0;
#X connect 16 0 15 1;
#X connect 17 0 12 0;
#X connect 18 0 1 0;
#X connect 18 1 26 2;
#X connect 19 0 31 0;
#X connect 20 0 33 0;
#X connect 21 0 26 0;
#X connect 21 1 38 0;
#X connect 22 0 23 0;
#X connect 23 0 21 0;
#X connect 23 1 20 0;
#X connect 24 0 22 1;
#X connect 27 0 3 0;
#X connect 29 0 26 3;
#X connect 29 1 14 0;
#X connect 30 0 22 0;
#X connect 30 1 36 0;
#X connect 31 0 4 1;
#X connect 31 1 37 0;
#X connect 32 0 8 0;
#X connect 32 1 31 1;
#X connect 33 0 27 1;
#X connect 33 1 26 1;
#X connect 35 0 20 1;
#X connect 35 1 21 1;
#X connect 36 0 24 0;
#X connect 36 1 35 0;
#X connect 37 0 38 0;
#X connect 37 1 38 1;
#X connect 38 0 13 1;
#X restore 192 182 pd handle_metadata;
#X obj 315 158 inlet metadata;
#X connect 0 0 2 0;
#X connect 1 0 9 0;
#X connect 2 0 1 0;
#X connect 3 0 6 0;
#X connect 4 0 3 0;
#X connect 5 0 8 0;
#X connect 6 0 7 0;
#X connect 6 1 10 0;
#X connect 7 0 8 0;
#X connect 9 0 4 0;
#X connect 9 1 10 1;
#X connect 11 0 10 2;
